# Phase 0: Monorepo Setup

Owner: Engineering  
Status: Planned  
Last Updated: 2026-02-21  
Depends On: `docs/technical/decisions/ADR-0011-monorepo-project-structure.md`, `docs/technical/decisions/ADR-0012-expo-for-mobile.md`, `docs/technical/decisions/ADR-0013-hono-api-framework.md`

## Overview

Scaffold the monorepo structure before E01 begins. This phase creates the foundational project structure so E01 can focus on implementation rather than setup.

**Duration:** 1-2 days  
**Priority:** P0 (must complete before E01)

## Tasks

| ID | Task | Points | Status |
|----|------|--------|--------|
| P0-T01 | Initialize Turborepo with pnpm workspaces | 2 | |
| P0-T02 | Create apps/api scaffold (Hono) | 1 | |
| P0-T03 | Create apps/admin-api scaffold (Hono) | 1 | |
| P0-T04 | Create apps/admin scaffold (TanStack Start) | 2 | |
| P0-T05 | Create apps/mobile scaffold (Expo) | 2 | |
| P0-T06 | Create packages/shared | 1 | |
| P0-T07 | Create packages/api-client with openapi-typescript | 2 | |
| P0-T08 | Create packages/ws-client (types package ready) | 1 | |
| P0-T09 | Create packages/admin-api-client | 1 | |
| P0-T10 | Configure shared TypeScript configs | 1 | |
| P0-T11 | Configure shared ESLint config | 1 | |
| P0-T12 | Set up Turborepo pipeline | 1 | |
| P0-T13 | Create root package.json scripts | 1 | |

**Total Points:** 17

## Detailed Steps

### P0-T01: Initialize Turborepo

```bash
# Create monorepo
pnpm create turbo@latest yoked

# Choose minimal template
# Manual setup for our structure
```

**Result:**
```
yoked/
├── package.json
├── pnpm-workspace.yaml
├── turbo.json
└── tsconfig.base.json
```

### P0-T02: Create apps/api

```bash
mkdir -p apps/api/src
cd apps/api
pnpm init
pnpm add hono @hono/node-server zod
pnpm add -D typescript @types/node tsx
```

**Structure:**
```
apps/api/
├── src/
│   ├── index.ts
│   └── routes/
├── openapi.yaml       # Copy from docs/technical/contracts/
├── asyncapi.yaml      # Copy from docs/technical/contracts/
├── package.json
└── tsconfig.json
```

### P0-T03: Create apps/admin-api

Same structure as apps/api, separate package.

### P0-T04: Create apps/admin

```bash
npx @tanstack/start@latest create apps/admin
```

**Structure:**
```
apps/admin/
├── src/
│   ├── routes/
│   └── components/
├── app.config.ts
├── package.json
└── tsconfig.json
```

### P0-T05: Create apps/mobile

```bash
npx create-expo-app@latest apps/mobile --template blank-typescript
cd apps/mobile
npx expo install expo-camera expo-notifications expo-secure-store
```

**Structure:**
```
apps/mobile/
├── src/
│   ├── screens/
│   ├── components/
│   ├── api/
│   └── stores/
├── app.json
├── eas.json
├── package.json
└── tsconfig.json
```

### P0-T06: Create packages/shared

```bash
mkdir -p packages/shared/src/{types,constants,utils}
```

**Structure:**
```
packages/shared/
├── src/
│   ├── types/
│   │   ├── user.ts
│   │   ├── match.ts
│   │   └── index.ts
│   ├── constants/
│   │   └── index.ts
│   ├── utils/
│   │   └── index.ts
│   └── index.ts
├── package.json
└── tsconfig.json
```

### P0-T07: Create packages/api-client

```bash
mkdir -p packages/api-client/src/generated
cd packages/api-client
pnpm add openapi-typescript
pnpm add -D typescript
```

**package.json:**
```json
{
  "name": "@yoked/api-client",
  "scripts": {
    "generate": "openapi-typescript ../../apps/api/openapi.yaml -o src/generated/schema.d.ts"
  }
}
```

### P0-T08: Create packages/ws-client

```bash
mkdir -p packages/ws-client/src/{generated,client}
cd packages/ws-client
pnpm add @asyncapi/modelina
pnpm add -D typescript
```

**package.json:**
```json
{
  "name": "@yoked/ws-client",
  "scripts": {
    "generate:types": "modelina -i ../../apps/api/asyncapi.yaml -o src/generated/types"
  }
}
```

**Structure:**
```
packages/ws-client/
├── src/
│   ├── generated/
│   │   └── types/     # Generated by Modelina
│   ├── client/
│   │   ├── WebSocketClient.ts
│   │   └── index.ts
│   └── index.ts
├── package.json
└── tsconfig.json
```

### P0-T09: Create packages/admin-api-client

Same as packages/api-client, pointing to admin-api openapi.yaml.

### P0-T10: Configure TypeScript

**tsconfig.base.json:**
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true
  }
}
```

**Per-package tsconfig.json:**
```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "outDir": "dist",
    "rootDir": "src"
  },
  "include": ["src"]
}
```

### P0-T11: Configure ESLint

**packages/eslint-config/index.js:**
```javascript
module.exports = {
  extends: [
    'eslint:recommended',
    '@typescript-eslint/recommended',
    'prettier'
  ],
  parser: '@typescript-eslint/parser',
  plugins: ['@typescript-eslint'],
  rules: {
    '@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_' }],
    '@typescript-eslint/explicit-function-return-type': 'off'
  }
}
```

### P0-T12: Turborepo Pipeline

**turbo.json:**
```json
{
  "$schema": "https://turbo.build/schema.json",
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    },
    "lint": {
      "dependsOn": ["^lint"]
    },
    "test": {
      "dependsOn": ["^build"]
    },
    "generate": {
      "cache": false
    }
  }
}
```

### P0-T13: Root Scripts

**package.json:**
```json
{
  "name": "yoked",
  "private": true,
  "scripts": {
    "dev": "turbo dev",
    "build": "turbo build",
    "lint": "turbo lint",
    "test": "turbo test",
    "generate:clients": "turbo run generate --filter='*client*'",
    "dev:api": "turbo dev --filter=api",
    "dev:admin": "turbo dev --filter=admin",
    "dev:mobile": "turbo dev --filter=mobile"
  },
  "devDependencies": {
    "turbo": "^2.0.0",
    "typescript": "^5.0.0"
  },
  "packageManager": "pnpm@9.0.0"
}
```

## Definition of Done

- [ ] All 4 apps created and runnable
- [ ] All 3 client packages created with generate scripts
- [ ] `pnpm install` works from root
- [ ] `pnpm dev:api` starts API
- [ ] `pnpm dev:mobile` starts Expo
- [ ] `pnpm build` completes without errors
- [ ] TypeScript compilation succeeds across all packages

## Next Steps

After Phase 0:
- Copy OpenAPI spec to `apps/api/openapi.yaml`
- Copy AsyncAPI spec to `apps/api/asyncapi.yaml`
- Generate initial API client types
- Begin E01 tasks
